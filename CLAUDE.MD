# Project Context for Claude Code

## Project Overview
Master's level database project comparing Cypher 5 and Cypher 25 query languages using IDFM (Ãle-de-France MobilitÃ©s) public transport data from GTFS format.

## Quick Reference
- **Current Phase**: âœ… Part 1 & 2 Complete â†’ Part 3 Ready (Testing & Analysis)
- **Dataset**: GTFS subsets (trips_subset.csv, stop_times_subset.csv)
- **Databases**: âœ… PostgreSQL + âœ… Neo4j (both loaded and tested)
- **Queries**: âœ… 9 files in `queries/` (Cypher 5, Cypher 25, SQL, GDS)
- **Documentation**: See `docs/` folder for detailed guides

## Project Structure

```
â”œâ”€â”€ CLAUDE.MD           â† You are here (high-level overview)
â”œâ”€â”€ CONSIGNES.MD        â† Assignment requirements (French)
â”œâ”€â”€ RAPPORT.md          â† Report (to be written)
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ PART1.MD        â† Data import guide (schemas, constraints, examples)
â”‚   â”œâ”€â”€ PART2.MD        â† Query patterns and SIGMOD findings
â”‚   â””â”€â”€ DATASETS.MD     â† GTFS data structure reference
â”œâ”€â”€ queries/            â† âœ… NEW! All query implementations
â”‚   â”œâ”€â”€ README.md       â† Query documentation and usage guide
â”‚   â”œâ”€â”€ 01_increasing_paths.cypher / .sql
â”‚   â”œâ”€â”€ 02_quantified_patterns.cypher / .sql
â”‚   â”œâ”€â”€ 03_shortest_path.cypher / .sql
â”‚   â”œâ”€â”€ 04_shortest_path_gds.cypher
â”‚   â””â”€â”€ 05_additional_patterns.cypher
â”œâ”€â”€ article/
â”‚   â”œâ”€â”€ SIGMOD.MD       â† Synthesized findings on Cypher 5 problems
â”‚   â”œâ”€â”€ QUERY_CHOMP_REPEAT.MD
â”‚   â””â”€â”€ SOLVE_HARD_GRAPH_PROBLEMS_WITH_CYPHER_25.MD
â””â”€â”€ export/             â† GTFS data files
```

## 3-Phase Workflow

### Phase 1: Data Import âœ… COMPLETE!
**Goal**: Load GTFS data into PostgreSQL and Neo4j

**What Was Done**:
1. âœ… Created subsets: trips_subset.csv (15k), stop_times_subset.csv (394k)
2. âœ… Neo4j: 54k stops, 15k trips, 200k transfers, constraints + indexes
3. âœ… PostgreSQL: Same data with foreign keys and check constraints
4. âœ… Tested queries - results match between both databases
5. âœ… Scripts: `neo4j-import.cypher`, `postgres-full-setup.sql`

**Model Chosen**: Hybrid (Stop, Trip, Route, Agency nodes with relationships)
**Reference**: `test-queries.md` for validation queries

### Phase 2: Query Development âœ… COMPLETE!
**Status**: Queries implemented, ready for testing
**Goal**: Implement Cypher 5, Cypher 25, and SQL queries

**What Was Done**:
1. âœ… 5 patterns implemented (increasing paths, quantified, shortest path, GDS, additional)
2. âœ… Cypher 5, Cypher 25 (documented), and SQL versions
3. âœ… All 4 mandatory comparisons covered
4. âœ… Performance tests and PROFILE/EXPLAIN queries included
5. âœ… Documentation: `queries/README.md` with usage guide

**Files Created**: `queries/*.cypher`, `queries/*.sql`

### Phase 3: Analysis & Report ğŸ“
**Status**: Ready to start (queries need testing)
**Goal**: Compare performance and write report

**Quick Steps**:
1. Compare Cypher 5 vs 25 vs SQL vs GDS
2. Analyze execution plans
3. Explain performance using SIGMOD lessons
4. Write French report

## Critical Information

### SIGMOD Core Finding
**Problem**: Cypher 5's `reduce` in WHERE clauses creates NP-complete queries
- Hamiltonian path: timeout at â‰¥10 nodes
- Subset sum: timeout at â‰¥27 nodes
- 93% of programmers misjudge query costs

**Solution**: Cypher 25 uses quantified patterns, allReduce, dedicated constructs

### 6 Mandatory Query Comparisons
1. **Increasing property paths** (NOT EXISTS vs allReduce)
2. **Quantified graph patterns** (Cypher 25 feature)
3. **Shortest path algorithms** (Cypher 5, 25, GDS comparison)
4. **GDS algorithms in Cypher 25** (implement directly)
5. **SQL comparisons** (including recursive queries)
6. **Execution plans** (analyze BFS uni vs bidirectional)

### Dataset Characteristics
- **Transport network**: Perfect for graph algorithms (paths, connectivity)
- **Numeric edges**: travel_time, transfer_time, traversal_time
- **Real-world**: IDFM Ãle-de-France public transport

## When Working With Claude

### I Should Prioritize
1. **Part 1 before Part 2** - Cannot query without data
2. **Test incrementally** - Small subset â†’ full data
3. **Document decisions** - Modeling choices for report
4. **Reference SIGMOD** - Explain why patterns fail
5. **Execution plans** - Show algorithmic differences

### Key Files to Reference
- `docs/PART1.MD` - When working on data import
- `docs/PART2.MD` - When designing queries
- `docs/DATASETS.MD` - For GTFS schema reference
- `article/SIGMOD.MD` - For problematic patterns
- `CONSIGNES.MD` - For assignment requirements

### Article Reading Strategy
- SIGMOD.MD already synthesized (see `docs/PART2.MD`)
- Read other articles only when implementing specific Cypher 25 features
- Don't re-read full articles unnecessarily (save tokens)

## Next Steps

### Immediate
ğŸ¯ **Start Part 3**: Test queries and collect performance metrics

**Actions requises**:
1. Tester les requÃªtes Cypher dans Neo4j Browser
2. Tester les requÃªtes SQL dans PostgreSQL
3. Installer Neo4j GDS plugin pour les algorithmes
4. Collecter les temps d'exÃ©cution et plans d'exÃ©cution
5. Documenter les rÃ©sultats pour le rapport

### Part 1 Summary
- âœ… Neo4j imported
- âœ… PostgreSQL imported: Same data, fully constrained
- âœ… Queries tested and validated on both databases
- âœ… Scripts: `neo4j-import.cypher`, `postgres-full-setup.sql`, `test-queries.md`
- âœ… Subsets: `generate_subset_files.sh` (optimized awk, 10-20 sec)

### Part 2 Summary
- âœ… increasing_paths.cypher / âŒ increasing_paths.sql
- âœ… quantified_patterns.cypher / âœ… quantified_patterns.sql

## Report Requirements (French)
Must include:
1. Data import strategy
2. Data cleaning process
3. Modeling decisions (reference course material)
4. Constraints and indexes
5. Execution plans with analysis
6. Query comparisons (all 6 mandatory)
7. Performance analysis
8. Explanations (reference SIGMOD lessons)

## Technology Stack
- **PostgreSQL**: Relational database
- **Neo4j**: Graph database (Cypher 5 & 25)
- **Neo4j GDS**: Graph Data Science library
- **Optional**: Memgraph, DuckDB (SQL PGQ)
